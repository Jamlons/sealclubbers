generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters", "postgresqlExtensions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  extensions = [citext]
}

model User {
  accountId Int             @id
  nickname  String          @unique @db.Citext
  userStats UserTankStats[]

  @@index([accountId])
}

model Tank {
  tankId       Int             @id
  name         String
  shortName    String
  nation       String
  tier         Int
  type         String
  big_icon     String
  contour_icon String
  description  String
  expDamage    Float           @default(0)
  expDef       Float           @default(0)
  expFrag      Float           @default(0)
  expSpot      Float           @default(0)
  expWinRate   Float           @default(0)
  userStats    UserTankStats[]

  @@index([tankId])
}

model UserTankStats {
  id               Int   @id @default(autoincrement())
  accountId        Int
  tankId           Int
  markOfMastery    Int
  totXp            Int
  numBattles       Int
  draws            Int
  wins             Int
  losses           Int
  dmgDealt         Int
  spots            Int
  frags            Int
  capPointsDropped Int
  maxDmg           Int
  maxFrag          Int
  maxXp            Int
  assisted         Int
  hitsPercent      Float
  survivedBattles  Int
  createdAt        Int
  wn8              Int   @default(0)
  user             User  @relation(fields: [accountId], references: [accountId])
  tankDetails      Tank  @relation(fields: [tankId], references: [tankId])

  @@unique([accountId, tankId, numBattles])
  @@index([accountId, tankId])
}
